# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Dowa Household Latrine survey.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
dowalatrinesurvey <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(dowalatrinesurvey, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey", ".csv")))
openxlsx::write.xlsx(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey",
".xlsx")))
setup_dictionary()
setup_roxygen()
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Dowa Household Latrine survey.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
dowalatrinesurvey <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(dowalatrinesurvey, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey", ".csv")))
openxlsx::write.xlsx(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey",
".xlsx")))
devtools::document()
devtools::check()
library(quarto)
install.packages("quarto")
library(quarto)
devtools::check()
devtools::install()
use_author(
given = "Emmanuel",
family = "Mhango",
role = c("aut", "cre"),
email = "emmanuellmhango@gmail.com",
comment = c(ORCID = "0000-0003-3197-6244")
)
use_author(given = "Rhodrick D.", family = "Sagawa", role = "ctb")
use_author(given = "Paul", family = "Kumpukwe", role = "ctb")
use_author(given = "Rodney", family = "Kananji", role = "ctb")
use_author(given = "Baleke", family = "Banda", role = "ctb")
use_author(given = "Veronica", family = "Chagunda", role = "ctb")
use_author(given = "Dickson", family = "Wandawanda", role = "ctb")
update_description()
devtools::document()
devtools::check()
devtools::install()
setup_readme()
dowalatrinesurvey <- data_in
# Clean community_type to remove trailing spaces
dowalatrinesurvey <- dowalatrinesurvey %>%
mutate(community_type = trimws(community_type))
# Plot with ggplot2
ggplot(dowalatrinesurvey, aes(x = longitude, y = latitude, color = community_type)) +
geom_point(size = 3, alpha = 0.7) +
labs(
title = "Spatial Distribution of Surveyed Households in Dowa",
x = "Longitude",
y = "Latitude",
color = "Community Type"
) +
theme_minimal()
library(maps)
dowalatrinesurvey <- data_in
# Clean community_type
dowalatrinesurvey <- dowalatrinesurvey %>% mutate(community_type = trimws(community_type))
# Get Malawi map data from maps package
malawi_map <- map_data("world", region = "Malawi")
# Plot
ggplot() +
geom_polygon(
data = malawi_map,
aes(x = long, y = lat, group = group),
fill = "gray90",
color = "black"
) +
geom_point(
data = data,
aes(x = longitude, y = latitude, color = community_type),
size = 3, alpha = 0.7
) +
coord_fixed(1.3) +  # fix aspect ratio for lat/lon
labs(
title = "Spatial Distribution of Surveyed Households by Community Type",
x = "Longitude",
y = "Latitude",
color = "Community Type"
) +
theme_minimal()
# Clean community_type
dowalatrinesurvey <- dowalatrinesurvey %>% mutate(community_type = trimws(community_type))
# Get Malawi map data from maps package
malawi_map <- map_data("world", region = "Malawi")
# Plot
ggplot() +
geom_polygon(
dowalatrinesurvey = malawi_map,
aes(x = long, y = lat, group = group),
fill = "gray90",
color = "black"
) +
geom_point(
dowalatrinesurvey = dowalatrinesurvey,
aes(x = longitude, y = latitude, color = community_type),
size = 3, alpha = 0.7
) +
coord_fixed(1.3) +  # fix aspect ratio for lat/lon
labs(
title = "Spatial Distribution of Surveyed Households by Community Type",
x = "Longitude",
y = "Latitude",
color = "Community Type"
) +
theme_minimal()
# Clean community_type
dowalatrinesurvey <- dowalatrinesurvey %>% mutate(community_type = trimws(community_type))
# Get Malawi map data from maps package
malawi_map <- map_data("world", region = "Malawi")
# Plot
ggplot() +
geom_polygon(
dowalatrinesurvey = malawi_map,
aes(x = longitude, y = latitude, group = group),
fill = "gray90",
color = "black"
) +
geom_point(
dowalatrinesurvey = dowalatrinesurvey,
aes(x = longitude, y = latitude, color = community_type),
size = 3, alpha = 0.7
) +
coord_fixed(1.3) +  # fix aspect ratio for lat/lon
labs(
title = "Spatial Distribution of Surveyed Households by Community Type",
x = "Longitude",
y = "Latitude",
color = "Community Type"
) +
theme_minimal()
# Get Malawi map data from maps package
malawi_map <- map_data("world", region = "Malawi")
# Plot using dowalatrinesurvey
ggplot() +
geom_polygon(
data = malawi_map,
aes(x = long, y = lat, group = group),
fill = "gray90",
color = "black"
) +
geom_point(
data = dowalatrinesurvey,
aes(x = longitude, y = latitude, color = community_type),
size = 3, alpha = 0.7
) +
coord_fixed(1.3) +  # fix aspect ratio for lat/lon
labs(
title = "Spatial Distribution of Surveyed Households by Community Type",
x = "Longitude",
y = "Latitude",
color = "Community Type"
) +
theme_minimal()
install.packages("stringr")
install.packages("stringr")
library(stringr)
# Clean and factor satisfaction variable
data <- dowalatrinesurvey %>%
mutate(
satisfaction_clean = str_extract(satisfaction_with_latrine, "^[0-9]"),
satisfaction_clean = factor(satisfaction_clean, levels = c("1", "2", "3"), labels = c("Not Satisfied", "Neutral", "Satisfied"))
)
# Summarize counts by community_type and satisfaction
satisfaction_summary <- data %>%
filter(!is.na(satisfaction_clean)) %>%
group_by(community_type, satisfaction_clean) %>%
summarise(count = n()) %>%
ungroup()
# Plot stacked bar chart
ggplot(satisfaction_summary, aes(x = community_type, y = count, fill = satisfaction_clean)) +
geom_bar(stat = "identity", position = "fill") +  # position = fill makes it relative proportions
scale_y_continuous(labels = scales::percent) +
labs(
title = "Latrine Satisfaction by Community Type",
x = "Community Type",
y = "Percentage",
fill = "Satisfaction Level"
) +
theme_minimal()
install.packages("scales")
install.packages("scales")
# Clean and factor satisfaction variable
library(scales)
# Clean and factor satisfaction variable
data <- dowalatrinesurvey %>%
mutate(
satisfaction_clean = str_extract(satisfaction_with_latrine, "^[0-9]"),
satisfaction_clean = factor(satisfaction_clean, levels = c("1", "2", "3"),
labels = c("Not Satisfied", "Neutral", "Satisfied"))
) %>%
filter(!is.na(satisfaction_clean))  # Filter out NA values here early
# Summarize counts by community_type and satisfaction
satisfaction_summary <- data %>%
group_by(community_type, satisfaction_clean) %>%
summarise(count = n(), .groups = "drop")
# Plot stacked bar chart without NA
ggplot(satisfaction_summary, aes(x = community_type, y = count, fill = satisfaction_clean)) +
geom_bar(stat = "identity", position = "fill") +  # relative proportions
scale_y_continuous(labels = percent_format()) +
labs(
title = "Latrine Satisfaction by Community Type",
x = "Community Type",
y = "Percentage",
fill = "Satisfaction Level"
) +
theme_minimal()
# Clean and factor satisfaction variable
library(scales)
library(stringr)
# Clean and factor satisfaction variable
data <- dowalatrinesurvey %>%
mutate(
satisfaction_clean = str_extract(satisfaction_with_latrine, "^[0-9]"),
satisfaction_clean = factor(satisfaction_clean, levels = c("1", "2", "3"),
labels = c("Not Satisfied", "Neutral", "Satisfied"))
) %>%
filter(!is.na(satisfaction_clean))  # Filter out NA values here early
# Summarize counts by community_type and satisfaction
satisfaction_summary <- data %>%
group_by(community_type, satisfaction_clean) %>%
summarise(count = n(), .groups = "drop")
# Plot stacked bar chart without NA
ggplot(satisfaction_summary, aes(x = community_type, y = count, fill = satisfaction_clean)) +
geom_bar(stat = "identity", position = "fill") +  # relative proportions
scale_y_continuous(labels = percent_format()) +
labs(
title = "Latrine Satisfaction by Community Type",
x = "Community Type",
y = "Percentage",
fill = "Satisfaction Level"
) +
theme_minimal()
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Dowa Household Latrine survey.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
dowalatrinesurvey <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(dowalatrinesurvey, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey", ".csv")))
openxlsx::write.xlsx(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey",
".xlsx")))
library(stringr)
# Clean and factor satisfaction variable
data <- dowalatrinesurvey %>%
mutate(
satisfaction_clean = str_extract(satisfaction_with_latrine, "^[0-9]"),
satisfaction_clean = factor(satisfaction_clean, levels = c("1", "2", "3"),
labels = c("Not Satisfied", "Neutral", "Satisfied"))
) %>%
filter(!is.na(satisfaction_clean))  # Remove NA
# Summarize counts
satisfaction_summary <- data %>%
group_by(community_type, satisfaction_clean) %>%
summarise(count = n(), .groups = "drop")
# Plot grouped bar chart (counts)
ggplot(satisfaction_summary, aes(x = community_type, y = count, fill = satisfaction_clean)) +
geom_bar(stat = "identity", position = "dodge") +  # side-by-side bars
labs(
title = "Latrine Satisfaction by Community Type",
x = "Community Type",
y = "Count",
fill = "Satisfaction Level"
) +
theme_minimal()
devtools::build_readme()
devtools::build_readme()
devtools::build_readme()
devtools::build_readme()
# Description ------------------------------------------------------------------
# R script to process uploaded raw data into a tidy, analysis-ready data frame
# Load packages ----------------------------------------------------------------
## Run the following code in console if you don't have the packages
## install.packages(c("usethis", "fs", "here", "readr", "readxl", "openxlsx"))
library(usethis)
library(fs)
library(here)
library(readr)
library(dplyr)
library(readxl)
library(openxlsx)
library(lubridate)
library(ggplot2)
library(maps)
# Load Data --------------------------------------------------------------------
# Load the necessary data from a CSV file
data_in <- readr::read_csv("data-raw/Dowa Household Latrine survey.csv")
# (Optional) Read and clean the codebook if needed (commented out for now)
# codebook <- readxl::read_excel("data-raw/codebook.xlsx") %>%
#   clean_names()
# Tidy data --------------------------------------------------------------------
# Remove rows where the 'latitude' column contains NULL (NA) values
data_in <- data_in %>%
filter(!is.na(latitude))
# Function to check for non-UTF-8 characters in character columns
check_utf8 <- function(df) {
# Identify columns with invalid UTF-8 characters
invalid_cols <- sapply(df, function(column) {
if (!is.character(column)) return(FALSE) # Skip non-character columns
any(sapply(column, function(x) {
if (is.na(x)) return(FALSE) # Ignore NA values
!identical(iconv(x, from = "UTF-8", to = "UTF-8"), x)
}))
})
# Extract the column names with invalid characters
bad_cols <- names(df)[invalid_cols]
# Output a message depending on whether non-UTF-8 characters were found
if (length(bad_cols) > 0) {
message("Non-UTF-8 characters detected in columns: ",
paste(bad_cols, collapse = ", "))
} else {
message("No non-UTF-8 characters found.")
}
}
# Convert character columns from Latin1 encoding to UTF-8, removing problematic
#   characters
data_in[] <- lapply(data_in, function(x) {
if (is.character(x)) {
# Convert to UTF-8 and remove problematic characters
iconv(x, from = "latin1", to = "UTF-8", sub = "")
} else {
x
}
})
# Re-check the data for non-UTF-8 characters after the conversion
check_utf8(data_in)
dowalatrinesurvey <- data_in
# Export Data ------------------------------------------------------------------
usethis::use_data(dowalatrinesurvey, overwrite = TRUE)
fs::dir_create(here::here("inst", "extdata"))
readr::write_csv(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey", ".csv")))
openxlsx::write.xlsx(dowalatrinesurvey,
here::here("inst", "extdata", paste0("dowalatrinesurvey",
".xlsx")))
devtools::build_readme()
devtools::build_readme()
